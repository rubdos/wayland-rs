<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>The SHM - The rusty wayland handbook</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../../">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="./intro.html">Introduction</a></li><li><a href="./wayland/intro.html"><strong>1.</strong> Wayland generalities</a></li><li><ul class="section"><li><a href="./wayland/structure.html"><strong>1.1.</strong> Protocol structure</a></li><li><a href="./wayland/p_core/intro.html"><strong>1.2.</strong> The Core protocol</a></li><li><ul class="section"><li><a href="./wayland/p_core/special.html"><strong>1.2.1.</strong> Special objects</a></li><li><a href="./wayland/p_core/compositor.html"><strong>1.2.2.</strong> The Compositor</a></li><li><a href="./wayland/p_core/shm.html" class="active"><strong>1.2.3.</strong> The SHM</a></li><li><a href="./wayland/p_core/shell.html"><strong>1.2.4.</strong> The Shell</a></li><li><a href="./wayland/p_core/subcompositor.html"><strong>1.2.5.</strong> The Subcompositor</a></li><li><a href="./wayland/p_core/seat.html"><strong>1.2.6.</strong> The Seats</a></li><li><a href="./wayland/p_core/output.html"><strong>1.2.7.</strong> The Outputs</a></li><li><a href="./wayland/p_core/data_device.html"><strong>1.2.8.</strong> The Data Device Manager</a></li></ul></li></ul></li><li><a href="./client/intro.html"><strong>2.</strong> Writing client apps</a></li><li><a href="./server/intro.html"><strong>3.</strong> Writing compositors</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title">The rusty wayland handbook</h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./wayland/p_core/shm.html#the-shm" name="the-shm"><h1>The SHM</h1></a>
<p>The <code>wl_shm</code> object represents the capacity for the compositor to use SHared Memory. This is the
most basic way for a client to send the compositor the contents of its surfaces, and the only one
included in the core protocol.</p>
<p>The SHM global allows the client to create several memory pools. Upon creation, it receives events
for the various buffer formats supported by the compositor (such as ARGB8888 for example).</p>
<a class="header" href="./wayland/p_core/shm.html#the-shm-pools" name="the-shm-pools"><h2>The SHM Pools</h2></a>
<p>The <code>wl_shm_pool</code> is created from the SHM global, and a file descriptor. This file descriptor is
sent to the compositor, and is the shared memory. The compositor will read from it the content
written by the client.</p>
<p>From an SHM pool object, the client can create buffers. Each buffer refers to a certain part of
the memory pool (specifying an offset, a width, a height and a stride).</p>
<p>SHM pools can be resized by the client (via the <code>wl_shm_pool::resize</code> request), but only to make
them bigger.</p>
<p>Creating a buffer referring to content outside of the real size of the pool is an error. The
effective behaviour of the compositor is platform-dependent: either it will read garbage (most
likely zeroed memory) and the content of the surface will silently be corrupt, or it will encounter
an error and trigger a protocol error as a consequence.</p>
<a class="header" href="./wayland/p_core/shm.html#the-buffers" name="the-buffers"><h2>The Buffers</h2></a>
<p>The <code>wl_buffer</code> object is actually more generic than SHM pools. It can be created from SHM pools,
but also from other medium in protocol extensions (DMABUF memories for example).</p>
<p>In any case, it refers to some slice of memory at some place (that the compositor is supposed to
have tracked at the creation of the buffer), and can be assigned to any surface.</p>
<p>It possesses a single event <code>wl_buffer::release</code>, sent by the compositor when it has finished
reading from the buffer, signaling the client that the underlying content can now be modified.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="./wayland/p_core/compositor.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="./wayland/p_core/shell.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./wayland/p_core/compositor.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./wayland/p_core/shell.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
